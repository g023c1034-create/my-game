<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>My Unity Game (16:9) with Leaderboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      margin: 0;
      background: #222;
      color: #fff;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      overflow-y: auto; /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚ã‚Š */
    }

    /* --- ã‚²ãƒ¼ãƒ ã‚³ãƒ³ãƒ†ãƒŠ --- */
    #unity-container {
      display: flex;
      justify-content: center;
      align-items: center;
      width: 100%;
      background: #111;
      padding: 10px 0;
    }

    /* --- ã‚²ãƒ¼ãƒ ç”»é¢: 16:9 æ¯”ç‡ --- */
    #unity-canvas {
      width: 90%;
      max-width: 1200px;
      aspect-ratio: 16 / 9; /* â˜…æ¯”ç‡ã‚’16:9ã«æˆ»ã™ */
      background: #111;
      border-radius: 8px;
      object-fit: contain;
    }

    /* --- ãƒªãƒ¼ãƒ€ãƒ¼ãƒœãƒ¼ãƒ‰ --- */
    #leaderboard-area {
      width: 90%;
      max-width: 600px;
      background: #333;
      border-radius: 10px;
      padding: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
      text-align: center;
      margin: 20px 0 40px;
    }

    #leaderboard-area h2 {
      margin: 0;
      font-size: 1.2rem;
    }

    #score-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 8px;
    }

    #score-table th, #score-table td {
      border: 1px solid #555;
      padding: 6px;
      text-align: center;
    }
  </style>
</head>
<body>

  <!-- Unityã‚²ãƒ¼ãƒ éƒ¨åˆ† -->
  <div id="unity-container">
    <canvas id="unity-canvas"></canvas>
  </div>

  <!-- ãƒªãƒ¼ãƒ€ãƒ¼ãƒœãƒ¼ãƒ‰éƒ¨åˆ† -->
  <div id="leaderboard-area">
    <h2>ğŸ† ãƒªãƒ¼ãƒ€ãƒ¼ãƒœãƒ¼ãƒ‰</h2>
    <table id="score-table">
      <thead>
        <tr><th>Rank</th><th>Name</th><th>Score</th></tr>
      </thead>
      <tbody id="leaderboard-body">
        <tr><td>-</td><td>Loading...</td><td>-</td></tr>
      </tbody>
    </table>
  </div>

  <script>
    // --- Unityã®è¨­å®š ---
    const buildUrl = "Build";
    const loaderUrl = buildUrl + "/Build.loader.js";
    const config = {
      dataUrl: buildUrl + "/Build.data.unityweb",
      frameworkUrl: buildUrl + "/Build.framework.unityweb",
      codeUrl: buildUrl + "/Build.wasm.unityweb",
      streamingAssetsUrl: "StreamingAssets",
      companyName: "YourCompany",
      productName: "My Unity Game",
      productVersion: "1.0",
      showBanner: (msg, type) => console.log(type + ": " + msg)
    };

    const canvas = document.querySelector("#unity-canvas");

    // Unityã®ãƒ­ãƒ¼ãƒ‰å‡¦ç†
    const script = document.createElement("script");
    script.src = loaderUrl;
    script.onload = () => {
      createUnityInstance(canvas, config, (progress) => {
        console.log("Loading: " + (progress * 100).toFixed(1) + "%");
      }).then((unityInstance) => {
        console.log("âœ… Unity Game Loaded!");
        window.unityGameInstance = unityInstance;
        fetchLeaderboard();
      }).catch((message) => {
        alert("âŒ Unity èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: " + message);
      });
    };
    document.body.appendChild(script);

    // --- ãƒªãƒ¼ãƒ€ãƒ¼ãƒœãƒ¼ãƒ‰å‡¦ç†ï¼ˆã‚µãƒ¼ãƒãƒ¼é€£æºï¼‰ ---
    async function fetchLeaderboard() {
      try {
        const response = await fetch("https://reaction_ranking"); // â† ã‚ãªãŸã®APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
        if (!response.ok) throw new Error("é€šä¿¡ã‚¨ãƒ©ãƒ¼");
        const scores = await response.json(); // [{rank: 1, name: "ã¬ãˆã´ã‚ˆ", score: 1234}, ...] å½¢å¼ã‚’æƒ³å®š

        const tbody = document.getElementById("leaderboard-body");
        tbody.innerHTML = "";

        scores.forEach((s) => {
          const row = tbody.insertRow();
          row.insertCell().textContent = s.rank ?? "-";
          row.insertCell().textContent = s.name ?? "(åç„¡ã—)";
          row.insertCell().textContent = s.score?.toLocaleString() ?? "-";
        });
      } catch (err) {
        console.error("âš ï¸ ãƒªãƒ¼ãƒ€ãƒ¼ãƒœãƒ¼ãƒ‰å–å¾—ã‚¨ãƒ©ãƒ¼:", err);
        const tbody = document.getElementById("leaderboard-body");
        tbody.innerHTML = `<tr><td colspan="3">èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</td></tr>`;
      }
    }

    // --- Unity â†’ JS ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•° ---
    window.SubmitScoreToWeb = async function (name, score) {
      console.log("Score received from Unity:", name, score);
      try {
        // ã‚¹ã‚³ã‚¢é€ä¿¡
        const response = await fetch("https://reaction_ranking", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ name: name, score: score }),
        });
        if (!response.ok) throw new Error("é€ä¿¡ã‚¨ãƒ©ãƒ¼");
        console.log("âœ… ã‚¹ã‚³ã‚¢é€ä¿¡æˆåŠŸ:", name, score);

        // æ›´æ–°ã•ã‚ŒãŸãƒªãƒ¼ãƒ€ãƒ¼ãƒœãƒ¼ãƒ‰ã‚’å†å–å¾—
        fetchLeaderboard();
      } catch (err) {
        console.error("âš ï¸ ã‚¹ã‚³ã‚¢é€ä¿¡ã‚¨ãƒ©ãƒ¼:", err);
      }
    };
  </script>

</body>
</html>


